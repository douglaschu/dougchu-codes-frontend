---
import { getPost, getPosts } from "../../lib/payload";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

export async function getStaticPaths() {
     const posts = await getPosts();
     return posts.map((post: any) => ({
          params: { slug: post.slug },
     }));
}

const { slug } = Astro.params;
const post = await getPost(slug!);

if (!post) {
     return Astro.redirect("/404");
}
---

<!doctype html>
<head>
     <meta charset="UTF-8" />
     <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
</head>
<body>
     <Header />
     <article>
          <h1>{post.title}</h1>
          <time
               >{
                    new Date(post.publishedAt).toLocaleDateString("en-US", {
                         year: "numeric",
                         month: "long",
                         day: "numeric",
                    })
               }</time
          >
          <!-- <div set:html={post.contentHTML} /> -->
          <div set:html={post.contentHTML} />
     </article>
     <a href="/blog">‚Üê Back to blog</a>
     <Footer />
</body>

<style>
     article {
          padding: 5rem;
          margin: 1rem;
     }
</style>
